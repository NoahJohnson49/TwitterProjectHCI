<!DOCTYPE HTML>
<html>
<head>
    <title>Tweet Location Filter</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="../static/ammap/ammap.css" type="text/css">
    <script src="../static/ammap/ammap.js" type="text/javascript"></script>
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
    <!-- map file should be included after ammap.js -->
    <script src="../static/ammap/usaLow.js" type="text/javascript"></script>
    <script>
        var map;

        AmCharts.ready(function() {
            map = new AmCharts.AmMap();
            AmCharts.theme = AmCharts.themes.light;
            map.zoomControl.homeButtonEnabled = false;
            map.colorSteps = 10;
            map.zoomControl.zoomControlEnabled = false;
            
            var dataProvider = {
                mapVar: AmCharts.maps.usaLow,


                areas: [
                    {
                    id: "US-AL",
                    value: 444710,
                    fontsize: 20,
                    description : "No data",
                    balloonText: "<b>[[title]]</b><br/>Sentiment: [[description]]<br/><br/>Tweets: [[value]]<br/>[[percent]]% of all US Tweets"
                },
                {
                    id: "US-AK",
                    value: 626932,
                    fontsize: 20,
                    description : "No data",
                    balloonText: "<b>[[title]]</b><br/>Sentiment: [[description]]<br/><br/>Tweets: [[value]]<br/>[[percent]]% of all US Tweets"
                    
                },
                {
                    id: "US-AZ",
                    value: 5130632,
                    fontsize: 20,
                    description : "No data",
                    balloonText: "<b>[[title]]</b><br/>Sentiment: [[description]]<br/><br/>Tweets: [[value]]<br/>[[percent]]% of all US Tweets"
                },
                {
                    id: "US-AR",
                    value: 2673400,
                    fontsize: 20,
                    description : "No data",
                    balloonText: "<b>[[title]]</b><br/>Sentiment: [[description]]<br/><br/>Tweets: [[value]]<br/>[[percent]]% of all US Tweets"
                  },
                {
                    id: "US-CA",
                    value: 33871648,
                    fontsize: 20,
                    description : "No data",
                    balloonText: "<b>[[title]]</b><br/>Sentiment: [[description]]<br/><br/>Tweets: [[value]]<br/>[[percent]]% of all US Tweets"
                },
                {
                    id: "US-CO",
                    value: 4301261},
                {
                    id: "US-CT",
                    value: 3405565},
                {
                    id: "US-DE",
                    value: 783600},
                {
                    id: "US-FL",
                    value: 15982378},
                {
                    id: "US-GA",
                    value: 8186453},
                {
                    id: "US-HI",
                    value: 1211537},
                {
                    id: "US-ID",
                    value: 1293953},
                {
                    id: "US-IL",
                    value: 12419293},
                {
                    id: "US-IN",
                    value: 6080485},
                {
                    id: "US-IA",
                    value: 2926324},
                {
                    id: "US-KS",
                    value: 2688418},
                {
                    id: "US-KY",
                    value: 4041769},
                {
                    id: "US-LA",
                    value: 4468976},
                {
                    id: "US-ME",
                    value: 1274923},
                {
                    id: "US-MD",
                    value: 5296486},
                {
                    id: "US-MA",
                    value: 6349097},
                {
                    id: "US-MI",
                    value: 9938444},
                {
                    id: "US-MN",
                    value: 4919479},
                {
                    id: "US-MS",
                    value: 2844658},
                {
                    id: "US-MO",
                    value: 5595211},
                {
                    id: "US-MT",
                    value: 902195},
                {
                    id: "US-NE",
                    value: 1711263},
                {
                    id: "US-NV",
                    value: 1998257},
                {
                    id: "US-NH",
                    value: 1235786},
                {
                    id: "US-NJ",
                    value: 8414350},
                {
                    id: "US-NM",
                    value: 1819046},
                {
                    id: "US-NY",
                    value: 18976457},
                {
                    id: "US-NC",
                    value: 8049313},
                {
                    id: "US-ND",
                    value: 642200},
                {
                    id: "US-OH",
                    value: 11353140},
                {
                    id: "US-OK",
                    value: 3450654},
                {
                    id: "US-OR",
                    value: 3421399},
                {
                    id: "US-PA",
                    value: 12281054},
                {
                    id: "US-RI",
                    value: 1048319},
                {
                    id: "US-SC",
                    value: 4012012},
                {
                    id: "US-SD",
                    value: 754844},
                {
                    id: "US-TN",
                    value: 5689283},
                {
                    id: "US-TX",
                    value: 20851820},
                {
                    id: "US-UT",
                    value: 2233169},
                {
                    id: "US-VT",
                    value: 608827},
                {
                    id: "US-VA",
                    value: 7078515},
                {
                    id: "US-WA",
                    value: 5894121},
                {
                    id: "US-WV",
                    value: 1808344},
                {
                    id: "US-WI",
                    value: 5363675},
                {
                    id: "US-WY",
                    value: 493782}]
            };

            map.areasSettings = {
                autoZoom: false
            };
            map.dataProvider = dataProvider;

            var valueLegend = new AmCharts.ValueLegend();
            valueLegend.right = 10;
            valueLegend.minValue = "Less Tweets";
            valueLegend.maxValue = "More Tweets";
            valueLegend.showAsGradient = true;
            map.valueLegend = valueLegend;
            map.write("mapdiv");
        });
    </script>
    <script type="text/javascript" charset="utf-8">
        var socket;

        $(document).ready(function() {
            // Use a "/test" namespace.
            // An application can open a connection on multiple namespaces, and
            // Socket.IO will multiplex all those connections on a single
            // physical channel. If you don't care about multiple channels, you
            // can set the namespace to an empty string.
            namespace = '/stream';

            // Connect to the Socket.IO server.
            // The connection URL has the following format:
            //     http[s]://<domain>:<port>[/<namespace>]
            socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

            // Event handler for new connections.
            // The callback function is invoked when a connection with the
            // server is established.
            socket.on('connect', function() {
                socket.emit('my_event', {data: 'I\'m connected!'});
            });

            socket.on('tweet', function(msg){
                $('#log').append('<br>' + $('<div/>').text('Location: ' + msg.data + ' - Sentiment: ' + msg.sentiment).html());
            });


            // Handlers for the different forms in the page.
            // These accept data from the user and send it to the server in a
            // variety of ways
            $('form#emit').submit(function(event) {
                socket.emit('new_filter', {data: $('#emit_data').val()});
                $("#log").html("");
                return false;
            });
        });
        function disconnect(){
            socket.emit('dis');
        }
        window.onbeforeunload = function() {
            disconnect();
            return null;
        }

    </script>
    
</head>
<body>
    <h1>Tweet Location Search</h1>
    <h2>Filter:</h2>
    <form id="emit" method="POST" action='#'>
        <input type="text" name="emit_data" id="emit_data" placeholder="Message">
        <input type="submit" value="Submit">
    </form>
    <div id="mapdiv" style="width: 100%; background-color:#fff; height: 500px;"></div>
    
    <h2>Locations:</h2>
    <div id="log"></div>
</body>
</html>
